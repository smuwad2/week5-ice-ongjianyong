<script>
    async function getCategories() {
        try {
            const response = await axios.get("http://localhost:3010/categories");
            showCategories(response.data);
        } catch (error) {
            console.log("Error fetching categories:", error);
        }
    }

    function showCategories(categories) {
        const select = document.getElementById("selectCategory");

        // Keep only the first 2 options ("To select", "All")
        while (select.options.length > 2) {
            select.remove(2);
        }

        categories.forEach(category => {
            const option = document.createElement("option");
            option.value = category;
            option.textContent = category;
            select.appendChild(option);
        });
    }

    function getItems() {
        const select = document.getElementById("selectCategory");
        const value = select.value;
        if (value === "0") return; // "To select" chosen, do nothing

        let url = "http://localhost:3010/items";
        if (value !== "all") {
            url += "?category=" + encodeURIComponent(value);
        }

        axios.get(url)
            .then(response => {
                showItems(response.data);
            })
            .catch(error => {
                console.log("Error fetching items:", error);
                showItems([]);
            });
    }

    function showItems(items) {
        const itemsList = document.getElementById("itemsList");

        // Clear previous content
        itemsList.innerHTML = "";

        if (!items || items.length === 0) {
            const p = document.createElement("p");
            p.className = "text-center";
            p.textContent = "No items";
            itemsList.appendChild(p);
            return;
        }

        items.forEach(item => {
            const col = document.createElement("div");
            col.className = "col-lg-4 col-md-6 col-12 mb-3";

            const card = document.createElement("div");
            card.className = "card h-100";

            const cardBody = document.createElement("div");
            cardBody.className = "card-body";

            const title = document.createElement("h5");
            title.className = "card-title";
            title.textContent = item.name;

            const category = document.createElement("h6");
            category.className = "card-subtitle mb-2 text-muted";
            category.textContent = item.category;

            const quantity = document.createElement("p");
            quantity.className = "card-text";
            quantity.textContent = "Quantity: " + item.quantity;

            const price = document.createElement("p");
            price.className = "card-text";
            price.textContent = "Price: $" + item.price;

            cardBody.appendChild(title);
            cardBody.appendChild(category);
            cardBody.appendChild(quantity);
            cardBody.appendChild(price);

            card.appendChild(cardBody);
            col.appendChild(card);
            itemsList.appendChild(col);
        });
    }
</script>
