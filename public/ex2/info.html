<!DOCTYPE html>
<html>
    <head>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div class="bg-light text-center p-5 mb-4">
            <h2>Choose an option:</h2>
            <label for="limit">Limit:</label>
            <input id="limit" type="number" min=1 max=5 value=1 onchange="getData()">
            <select onchange="getData()" id="type">
                <option value="customers">Customers</option>
                <option value="products">Products</option>
                <option value="suppliers">Suppliers</option>
            </select>
            
        </div>
        <div id="result">
            
        </div>
        <script>
            async function getData() {
                const limitInput = document.getElementById('limit').value;
                const typeInput = document.getElementById('type').value;
                const url = '/data';
                try {
                    const response = await axios.get(url, {
                        params: {
                            limit: limitInput,
                            type: typeInput
                        }
                    });
                    generateTable(response.data);
                }
                
                catch (error){
                    console.log(error);
                    const resultDivElem = document.getElementById('result');
                    resultDivElem.innerHTML = "Error fetching data.";
                }
            
                function generateTable(dataObj){
                    const resultDivElem = document.getElementById('result');
                    while (resultDivElem.firstChild){ // make sure only 1 header
                        resultDivElem.firstChild.remove();
                    }
                    //create h2 element
                    const h2Elem = document.createElement('h2');
                    h2Elem.innerText = dataObj['type'];
                    resultDivElem.appendChild(h2Elem);

                    /*create table element
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                    */
                    const tableElem = document.createElement('table');
                    tableElem.className = 'table';
                    const tHeadElem = document.createElement('thead');
                    const tBodyElem = document.createElement('tbody');

                    // create table heading elements
                    const trHeaderElem = document.createElement('tr');
                    const tblHeadings = Object.keys(dataObj.records[0] || {});
                    for (const headingVal of tblHeadings){
                        const thElem = document.createElement("th");
                        thElem.innerText = headingVal;
                        trHeaderElem.appendChild(thElem);
                    }
                    tHeadElem.appendChild(trHeaderElem);
                    tableElem.appendChild(tHeadElem);

                    //create the table body elements
                    //loop through the elements in records array
                    for (let i = 0; i < dataObj.records.length; i++){
                        const trBodyElem = document.createElement('tr');
                        for (let j = 0; j < tblHeadings.length; j++){
                            const propVal = dataObj.records[i][tblHeadings[j]];
                            const tdElem = document.createElement('td');
                            tdElem.innerText = propVal;
                            trBodyElem.appendChild(tdElem);
                        }
                        tBodyElem.appendChild(trBodyElem);
                    }
                    
                    tableElem.appendChild(tBodyElem);
                    resultDivElem.appendChild(tableElem);
                }
            }
            
            // Call on initial load
            getData();

        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    </body>
</html>